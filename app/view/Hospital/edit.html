{include file="Common/top" title="首页" metas='' /}

{if condition="authority('HospitalEdit')"}
<div class="main-container">
    <div class="padding-md">
        <ul class="breadcrumb">
            <li><span class="primary-font"><i class="icon-home"></i></span><a href="__PRO_PATH__/">首页</a></li>
            <li><span class="primary-font"><i class="icon-home"></i></span><a href="__PRO_PATH__/Hospital/index">医院信息</a></li>
            <li>编辑信息</li>
        </ul>

        <div class="form-wrapper">
            <form class="form-horizontal" method="post" id="new-apply-form">

                <div :class="['form-group', errors.name != '' ? 'has-error' : '']" >
                    <label for="hospital_name" class="col-sm-2 control-label">医院名称：</label>
                    <div class="col-sm-4">
                        <input class="form-control" type="text" name="hospital_name" value="{$Hospital.name ?? ''}" placeholder="请输入医院全称" id="hospital_name">
                        <p class="help-block">{{errors.name}}</p>
                    </div>
                </div>

                <div :class="['form-group', errors.master != '' ? 'has-error' : '']" >
                    <label for="hospital_master" class="col-sm-2 control-label">院长姓名：</label>
                    <div class="col-sm-4">
                        <input class="form-control" type="text" name="hospital_master" value="{$Hospital.master ?? ''}" placeholder="请输入院长姓名" id="hospital_master">
                        <p class="help-block">{{errors.master}}</p>
                    </div>
                </div>

                <!--<div :class="['form-group']" >
                    <label for="hospital_logo" class="col-sm-2 control-label">医院logo：</label>
                    <div class="col-sm-4">
                        <input class="form-control" type="text" name ="hospital_logo" value="" placeholder="请上传医院LOGO" id="hospital_logo">
                    </div>
                </div>-->

                <div class="form-group {$errors.img ?= 'has-error'}">
                    <label class="col-sm-2 control-label">医院logo：</label>
                    <div class="col-sm-4">
                        <div id="filelist_hospital_logo">
                            <div>{$data.hospital_logo_origin??''}<b></b></div>
                        </div>
                        <br/>
                        <div id="upload_right_eye">
                            <a id="pickfiles_hospital_logo" href="javascript:;" style="position: relative;z-index: 1;">选择文件</a>
                            <a id="uploadfiles_hospital_logo" href="javascript:;">上传</a>
                        </div>
                        <input type="hidden" name="hospital_logo" value="{$Hospital.logo??''}"/>
                        <input type="hidden" name="hospital_logo_origin" value="{$Hospital.logo??''}"/>
                        <span class="help-block">{$errors.hospital_logo?? ''}</span>
                    </div>
                </div>

                <div :class="['form-group', errors.phone != '' ? 'has-error' : '']">
                    <label for="hospital_phone" class="col-sm-2 control-label">联系方式：</label>
                    <div class="col-sm-4">
                        <input class="form-control" type="text" name="hospital_phone" value="{$Hospital.phone}" placeholder="请输入医院联系方式" id="hospital_phone">
                        <p class="help-block">{{errors.phone}}</p>
                    </div>
                </div>

                <div :class="['form-group']" >
                    <label for="hospital_url" class="col-sm-2 control-label">医院网站：</label>
                    <div class="col-sm-4">
                        <input class="form-control" type="text" name="hospital_url" value="{$Hospital.url}" placeholder="请输入医院网站" id="hospital_url">
                    </div>
                </div>

                <div :class="['form-group']" >
                    <label for="hospital_email" class="col-sm-2 control-label">医院邮箱：</label>
                    <div class="col-sm-4">
                        <input class="form-control" type="text" name="hospital_email" value="{$Hospital.email}" placeholder="请输入医院邮箱" id="hospital_email">
                    </div>
                </div>

                <div :class="['form-group']" >
                    <label for="hospital_address" class="col-sm-2 control-label">医院地址：</label>
                    <div class="col-sm-4">
                        <input class="form-control" type="text" name="hospital_address" value="{$Hospital.address}" placeholder="请输入医院地址" id="hospital_address">
                    </div>
                </div>

                <div :class="['form-group']" >
                    <label for="hospital_postcode" class="col-sm-2 control-label">医院邮编：</label>
                    <div class="col-sm-4">
                        <input class="form-control" type="text" name="hospital_postcode" value="{$Hospital.postcode}" placeholder="请输入医院邮编" id="hospital_postcode">
                    </div>
                </div>

                <div :class="['form-group', errors.type != '' ? 'has-error' : '']" >
                    <label for="hospital_type" class="col-sm-2 control-label">医院类型：</label>
                    <div class="col-sm-4">
                        <input class="form-control" type="text" name="hospital_type" value="{$Hospital.type}" placeholder="比如：‘综合类’" id="hospital_type">
                        <p class="help-block">{{errors.type}}</p>
                    </div>
                </div>

                <div :class="['form-group', errors.level != '' ? 'has-error' : '']">
                    <label for="hospital_level" class="col-sm-2 control-label">医院等级：</label>
                    <div class="col-sm-4">
                        <input class="form-control" type="text" name="hospital_level" value="{$Hospital.level}" placeholder="比如：‘三级甲等’" id="hospital_level">
                        <p class="help-block">{{errors.level}}</p>
                    </div>
                </div>

                <div :class="['form-group']" >
                    <label for="hospital_info" class="col-sm-2 control-label">医院信息：</label>
                    <div class="col-sm-4">
                        <textarea class="form-control" type="text" name="hospital_info" placeholder="请输入医院详细信息" id="hospital_info">{$Hospital.info}</textarea>
                    </div>
                </div>

                <div :class="['form-group']" >
                    <label for="hospital_honor" class="col-sm-2 control-label">所获荣誉：</label>
                    <div class="col-sm-4">
                        <textarea class="form-control" type="text" name="hospital_honor"  placeholder="请输入所获荣誉奖项" id="hospital_honor">{$Hospital.honor}</textarea>
                    </div>
                </div>

                <div :class="['form-group']" >
                    <label for="hospital_role" class="col-sm-2 control-label">医院角色：</label>
                    <div class="col-sm-4">
                        <select name="hospital_role" class="form-control"  id="hospital_role">
                            <option value="1">不可会诊医院</option>
                            <option value="2">可会诊医院</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10 lab-btns">
                        <a class="btn btn-success" id="new-apply-form-save" @click="createNewApply">保存</a>
                        <a id="form-cancel" class="btn btn-info">取消</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{include file="Common/calendar" /}
{include file="Common/popup_warn" /}
{include file="Common/popup_list" /}
{include file="Common/calendar" /}
{include file="Common/bottom" /}
{include file="Common/upload"}
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/js/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/js/ueditor/ueditor.all.min.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/js/ueditor/lang/zh-cn/zh-cn.js"></script>
<script>
    $('#consensus-nav-apply').addClass('active');

    function clickRadio(value)
    {
        if(value == 5){
            vm.seen['ill_type'] = !vm.seen['ill_type'];
        } else{
            vm.seen['ill_type'] = false;
        }
    }

    var vm = new Vue({
        el: '#new-apply-form',
        data: {
            params: {},
            seen:{
                ill_type: false
            },
            errors:{
                name:'',
                master:'',
                level:'',
                phone:'',
                type:''
            }
        },

        mounted:function () {
            $(".flatpickr").flatpickr({time_24hr:true});
            $('select[name="hospital_role"]').val('{$Hospital.role??""}');
            $(".multiple").multipleSelect({
                filter: true,
                multiple: true,
                selectAll: true
            });
            myupload({
                container: 'upload_right_eye',
                browse: 'pickfiles_hospital_logo',
                url: '__PRO_PATH__/Media/upload?dir=import',
                img_types: 'jpg,gif,png',
                zip_types: 'zip',
                filelist: 'filelist_hospital_logo',
                uploadfiles: 'uploadfiles_hospital_logo',
                file_size: '10mb',
                onUploaded: function (up, file, result) {
                    $("input[name='hospital_logo_origin']").val(file.name);
                    var res = JSON.parse(result.response);
                    $("input[name='hospital_logo']").val(res.result.file);
                },
                isMulti: false
            });
        },

        methods: {
            createNewApply: function () {
                getParams();
                $.post('__PRO_PATH__/Hospital/edit', vm.params, function (res) {
                    if (res.error_code == 0) {
                        $.each(vm.errors, function (k) {
                            vm.errors[k] = '';
                        });
                        popWarn('新建成功');
                        window.location.href = '__PRO_PATH__/Hospital/index';
                    } else if (res.error_code == 2) {
                        $.each(vm.errors, function (k) {
                            vm.errors[k] = '';
                        });
                        $.each(res.errors, function (k, v) {
                            vm.errors[k] = v;
                        });
                        console.log(JSON.stringify(vm.errors));
                    }
                });
            },

        }
    });

    $(".multiple").multipleSelect({
        filter: true,
        multiple: true,
        selectAll: true
    });

    $(function () {
        $("#new-apply-form-target").multipleSelect("checkAll");
    });

    $('#form-cancel').on('click', function(){
        window.location.href = '__PRO_PATH__/Apply/index';
    });

    function getParams(){
        var data = $('#new-apply-form').serializeArray();
        $.each(data, function() {
            vm.params[this.name] = this.value;
        });

        /*$.each(vm.patient, function (k, v) {
         vm.params[k] = v;
         });*/
        console.log(JSON.stringify(data));
        console.log(JSON.stringify(vm.params));
    }
</script>
{else /}
<div class="main-container">
    <div class="padding-md">
        <span class="col-lg-12" style="font-size: larger; text-align: center">
			<strong>抱歉，您访问的页面不存在！</strong>
		</span>
    </div>
</div>
{include file="Common/bottom" /}
{/if}
